<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relative Humidity Simulator</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        nav {
            background: #333;
            padding: 10px;
            text-align: center;
        }
        nav a {
            color: white;
            text-decoration: none;
            margin: 0 15px;
            font-weight: bold;
        }
        nav a:hover { text-decoration: underline; }

        .page-header {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            text-align: center;
            padding: 30px 20px 20px;
        }
        .page-header h1 { margin: 0 0 6px; font-size: 1.6em; }
        .page-header p { margin: 0; color: #a0b8d8; font-size: 0.9em; }

        .sim-layout {
            max-width: 1100px;
            margin: 20px auto;
            padding: 0 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        /* Panels */
        .panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .panel h2 {
            font-size: 15px;
            color: #333;
            margin: 0 0 14px;
            padding-bottom: 8px;
            border-bottom: 2px solid #eee;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .outdoor-panel { flex: 1; min-width: 260px; }
        .indoor-panel { flex: 1; min-width: 320px; }
        .results-panel { width: 100%; }

        /* Slider groups */
        .slider-group {
            margin-bottom: 18px;
        }
        .slider-group label {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #555;
            margin-bottom: 6px;
        }
        .slider-group label .val {
            font-weight: 700;
            color: #333;
            font-family: 'Courier New', monospace;
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            outline: none;
            cursor: pointer;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 3px solid #333;
            cursor: pointer;
            box-shadow: 0 1px 4px rgba(0,0,0,0.3);
        }
        .temp-slider { background: linear-gradient(to right, #2980b9, #aaa, #c0392b); }
        .dp-slider { background: linear-gradient(to right, #1a5276, #5dade2); }

        /* Controls */
        .control-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }
        .control-row label {
            font-size: 13px;
            color: #555;
            min-width: 90px;
        }
        select, .toggle-btn {
            font-size: 13px;
            padding: 6px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            background: white;
            cursor: pointer;
        }
        select:focus { border-color: #4a7aff; outline: none; }
        .toggle-btn {
            min-width: 60px;
            text-align: center;
            font-weight: 600;
            transition: all 0.2s;
            user-select: none;
        }
        .toggle-btn.on {
            background: #27ae60;
            color: white;
            border-color: #27ae60;
        }
        .toggle-btn.off {
            background: #eee;
            color: #888;
        }
        .toggle-btn.open-state {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }

        /* Results */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        .result-card {
            text-align: center;
            padding: 16px;
            border-radius: 8px;
            background: #f8f9fa;
            border: 1px solid #eee;
        }
        .result-card .label {
            font-size: 12px;
            color: #777;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }
        .result-card .value {
            font-size: 32px;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }
        .result-card .unit {
            font-size: 14px;
            color: #888;
            margin-left: 2px;
        }
        .result-card .sub {
            font-size: 11px;
            color: #999;
            margin-top: 4px;
        }

        /* RH gauge */
        .rh-gauge {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            position: relative;
            margin: 0 auto 8px;
        }
        .rh-gauge .rh-number {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 36px;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }
        .rh-gauge .rh-pct {
            font-size: 16px;
            color: #888;
        }

        /* Status messages */
        .status-bar {
            margin-top: 12px;
            padding: 10px 14px;
            background: #f0f4ff;
            border-radius: 6px;
            font-size: 13px;
            color: #444;
            line-height: 1.6;
            min-height: 40px;
        }

        /* Comfort scale */
        .comfort-bar {
            height: 10px;
            border-radius: 5px;
            background: linear-gradient(to right, #c0392b, #e67e22, #27ae60, #27ae60, #e67e22, #c0392b);
            margin: 8px 0 4px;
            position: relative;
        }
        .comfort-marker {
            position: absolute;
            top: -4px;
            width: 4px;
            height: 18px;
            background: #333;
            border-radius: 2px;
            transition: left 0.3s;
        }
        .comfort-labels {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #999;
        }

        @media (max-width: 700px) {
            .sim-layout { flex-direction: column; }
        }
    </style>
</head>
<body>
    <nav>
        <a href="index.html">Thermal Analysis</a>
        <a href="mixing-ratio.html">Mixing Ratio</a>
        <a href="states-of-matter.html">States of Matter</a>
        <a href="lectures.html">Lectures</a>
        <a href="relative-humidity.html">RH Simulator</a>
    </nav>

    <div class="page-header">
        <h1>Relative Humidity Simulator</h1>
        <p>See how temperature, dew point, and indoor activities affect humidity</p>
    </div>

    <div class="sim-layout">
        <!-- Outdoor -->
        <div class="panel outdoor-panel">
            <h2>Outdoor Conditions</h2>
            <div class="slider-group">
                <label>Temperature <span class="val" id="outTempVal">32°F</span></label>
                <input type="range" class="temp-slider" id="outTemp" min="-40" max="120" value="32">
            </div>
            <div class="slider-group">
                <label>Dew Point <span class="val" id="outDpVal">20°F</span></label>
                <input type="range" class="dp-slider" id="outDp" min="-40" max="120" value="20">
            </div>
            <div class="result-card" style="margin-top: 12px;">
                <div class="label">Outdoor RH</div>
                <div class="value" id="outRH" style="color: #2980b9;">65<span class="unit">%</span></div>
            </div>
        </div>

        <!-- Indoor -->
        <div class="panel indoor-panel">
            <h2>Indoor Controls</h2>
            <div class="control-row">
                <label>Thermostat:</label>
                <select id="thermostat">
                    <option value="85">85°F</option>
                    <option value="80">80°F</option>
                    <option value="75">75°F</option>
                    <option value="70" selected>70°F</option>
                    <option value="65">65°F</option>
                    <option value="60">60°F</option>
                    <option value="55">55°F</option>
                </select>
            </div>
            <div class="control-row">
                <label>Furnace:</label>
                <div class="toggle-btn off" id="furnaceBtn" onclick="toggleFurnace()">OFF</div>
            </div>
            <div class="control-row">
                <label>A/C:</label>
                <div class="toggle-btn off" id="acBtn" onclick="toggleAC()">OFF</div>
            </div>
            <div class="control-row">
                <label>Door:</label>
                <div class="toggle-btn off" id="doorBtn" onclick="toggleDoor()">Closed</div>
            </div>
            <div class="control-row">
                <label>Activity:</label>
                <select id="activity">
                    <option value="none">Hang out</option>
                    <option value="shower">Shower</option>
                    <option value="cook">Cook</option>
                    <option value="party">Party</option>
                    <option value="bigparty">Big Party</option>
                    <option value="humidifier">Humidifier</option>
                </select>
            </div>
        </div>

        <!-- Results -->
        <div class="panel results-panel">
            <h2>Indoor Conditions</h2>
            <div class="results-grid">
                <div class="result-card">
                    <div class="label">Indoor Temp</div>
                    <div class="value" id="inTempDisp">70<span class="unit">°F</span></div>
                    <div class="sub" id="inTempC">21°C</div>
                </div>
                <div class="result-card">
                    <div class="label">Indoor Dew Point</div>
                    <div class="value" id="inDpDisp" style="color: #5dade2;">40<span class="unit">°F</span></div>
                    <div class="sub" id="inDpC">4°C</div>
                </div>
                <div class="result-card">
                    <div class="label">Indoor Relative Humidity</div>
                    <canvas id="rhGauge" width="160" height="160" style="display:block; margin: 0 auto;"></canvas>
                    <div class="sub" id="rhComfort">Comfortable</div>
                </div>
                <div class="result-card">
                    <div class="label">Comfort Level</div>
                    <div class="comfort-bar"><div class="comfort-marker" id="comfortMarker"></div></div>
                    <div class="comfort-labels"><span>Too Dry</span><span>Ideal</span><span>Too Humid</span></div>
                    <div class="sub" id="comfortText" style="margin-top:8px; font-size: 13px; color: #333; font-weight: 600;">Good</div>
                </div>
            </div>
            <div class="status-bar" id="statusBar">System idle. Adjust outdoor conditions or indoor controls to see changes.</div>
        </div>
    </div>

    <script>
    // --- Physics ---
    // Saturation vapor pressure coefficients (polynomial approximation, temp in Celsius)
    const coef = [6.1104546, 0.4442351, 1.4302099e-2, 2.6454708e-4,
                  3.0357098e-6, 2.0972268e-8, 6.0487594e-11, -1.469687e-13];

    function satVaporPressure(tempC) {
        let e = coef[0];
        let t = tempC;
        for (let i = 1; i < coef.length; i++) {
            e += coef[i] * t;
            t *= tempC;
        }
        return Math.max(e, 0.01);
    }

    function calcRH(tempF, dpF) {
        const tempC = (tempF - 32) * 5 / 9;
        const dpC = (dpF - 32) * 5 / 9;
        const satvap = satVaporPressure(tempC);
        const actvap = satVaporPressure(dpC);
        return Math.min(100, Math.max(0, Math.round(100 * actvap / satvap)));
    }

    function fToC(f) { return Math.round((f - 32) * 5 / 9); }

    // --- State ---
    let outdoorTemp = 32;
    let outdoorDp = 20;
    let indoorTemp = 70;
    let indoorDp = 40;
    let furnaceOn = false;
    let acOn = false;
    let doorOpen = false;
    let activityTimer = 0;

    // Activity effects: [tempChange/tick, dpChange/tick, duration ticks]
    const activities = {
        none: [0, 0, 0],
        shower: [0.3, 2.0, 10],
        cook: [0.8, 0.3, 8],
        party: [1.0, 2.0, 12],
        bigparty: [2.0, 3.0, 12],
        humidifier: [0, 0, 0] // special handling
    };

    // --- DOM ---
    const outTempSlider = document.getElementById('outTemp');
    const outDpSlider = document.getElementById('outDp');

    outTempSlider.addEventListener('input', () => {
        outdoorTemp = parseInt(outTempSlider.value);
        // Dew point can't exceed temperature
        if (outdoorDp > outdoorTemp) {
            outdoorDp = outdoorTemp;
            outDpSlider.value = outdoorDp;
        }
        outDpSlider.max = outdoorTemp;
        updateDisplay();
    });

    outDpSlider.addEventListener('input', () => {
        outdoorDp = parseInt(outDpSlider.value);
        updateDisplay();
    });

    function toggleFurnace() {
        furnaceOn = !furnaceOn;
        if (furnaceOn) acOn = false;
        updateButtons();
    }
    function toggleAC() {
        acOn = !acOn;
        if (acOn) furnaceOn = false;
        updateButtons();
    }
    function toggleDoor() {
        doorOpen = !doorOpen;
        updateButtons();
    }

    function updateButtons() {
        const fb = document.getElementById('furnaceBtn');
        fb.textContent = furnaceOn ? 'ON' : 'OFF';
        fb.className = 'toggle-btn ' + (furnaceOn ? 'on' : 'off');

        const ab = document.getElementById('acBtn');
        ab.textContent = acOn ? 'ON' : 'OFF';
        ab.className = 'toggle-btn ' + (acOn ? 'on' : 'off');

        const db = document.getElementById('doorBtn');
        db.textContent = doorOpen ? 'Open' : 'Closed';
        db.className = 'toggle-btn ' + (doorOpen ? 'open-state' : 'off');
    }

    function drawGauge(rh) {
        const canvas = document.getElementById('rhGauge');
        const ctx = canvas.getContext('2d');
        const cx = 80, cy = 90, r = 65;
        ctx.clearRect(0, 0, 160, 160);

        // Background arc
        ctx.beginPath();
        ctx.arc(cx, cy, r, Math.PI, 0, false);
        ctx.lineWidth = 12;
        ctx.strokeStyle = '#eee';
        ctx.stroke();

        // Colored arc
        const angle = Math.PI + (rh / 100) * Math.PI;
        let color;
        if (rh < 25) color = '#e74c3c';
        else if (rh < 35) color = '#e67e22';
        else if (rh <= 55) color = '#27ae60';
        else if (rh <= 65) color = '#e67e22';
        else color = '#e74c3c';

        ctx.beginPath();
        ctx.arc(cx, cy, r, Math.PI, angle, false);
        ctx.lineWidth = 12;
        ctx.strokeStyle = color;
        ctx.lineCap = 'round';
        ctx.stroke();

        // Text
        ctx.fillStyle = '#333';
        ctx.font = 'bold 34px Courier New';
        ctx.textAlign = 'center';
        ctx.fillText(rh + '%', cx, cy + 5);

        ctx.font = '11px Segoe UI';
        ctx.fillStyle = '#999';
        ctx.fillText('0%', cx - r + 5, cy + 20);
        ctx.fillText('100%', cx + r - 8, cy + 20);
    }

    function updateDisplay() {
        document.getElementById('outTempVal').textContent = outdoorTemp + '°F';
        document.getElementById('outDpVal').textContent = outdoorDp + '°F';

        const outRH = calcRH(outdoorTemp, outdoorDp);
        document.getElementById('outRH').innerHTML = outRH + '<span class="unit">%</span>';

        const inRH = calcRH(indoorTemp, indoorDp);
        document.getElementById('inTempDisp').innerHTML = Math.round(indoorTemp) + '<span class="unit">°F</span>';
        document.getElementById('inTempC').textContent = fToC(indoorTemp) + '°C';
        document.getElementById('inDpDisp').innerHTML = Math.round(indoorDp) + '<span class="unit">°F</span>';
        document.getElementById('inDpC').textContent = fToC(indoorDp) + '°C';

        drawGauge(inRH);

        // Comfort
        let comfort, comfortColor;
        if (inRH < 25) { comfort = 'Very Dry'; comfortColor = '#e74c3c'; }
        else if (inRH < 35) { comfort = 'Slightly Dry'; comfortColor = '#e67e22'; }
        else if (inRH <= 55) { comfort = 'Comfortable'; comfortColor = '#27ae60'; }
        else if (inRH <= 65) { comfort = 'Slightly Humid'; comfortColor = '#e67e22'; }
        else { comfort = 'Too Humid'; comfortColor = '#e74c3c'; }

        document.getElementById('rhComfort').textContent = comfort;
        document.getElementById('rhComfort').style.color = comfortColor;
        document.getElementById('comfortText').textContent = comfort;
        document.getElementById('comfortText').style.color = comfortColor;

        const markerPos = Math.min(100, Math.max(0, inRH));
        document.getElementById('comfortMarker').style.left = markerPos + '%';

        // Status
        const msgs = [];
        if (furnaceOn) msgs.push('Furnace is heating the house.');
        if (acOn) msgs.push('A/C is cooling the house.');
        if (doorOpen) msgs.push('Door is open — air exchanging with outdoors.');
        const act = document.getElementById('activity').value;
        if (act !== 'none') msgs.push('Activity: ' + document.getElementById('activity').selectedOptions[0].text);
        if (msgs.length === 0) msgs.push('System idle. Adjust outdoor conditions or indoor controls to see changes.');
        document.getElementById('statusBar').textContent = msgs.join(' ');
    }

    // --- Simulation loop (1 tick per second) ---
    function simTick() {
        const thermoTarget = parseInt(document.getElementById('thermostat').value);
        const act = document.getElementById('activity').value;
        const exchRate = doorOpen ? 0.5 : 0.03;
        const dpExchRate = doorOpen ? 0.5 : 0.01;

        // Air exchange: indoor conditions drift toward outdoor
        if (indoorTemp > outdoorTemp) {
            indoorTemp -= Math.min(exchRate, indoorTemp - outdoorTemp);
        } else if (indoorTemp < outdoorTemp) {
            indoorTemp += Math.min(exchRate, outdoorTemp - indoorTemp);
        }

        if (indoorDp > outdoorDp) {
            indoorDp -= Math.min(dpExchRate, indoorDp - outdoorDp);
        } else if (indoorDp < outdoorDp) {
            indoorDp += Math.min(dpExchRate, outdoorDp - indoorDp);
        }

        // Furnace
        if (furnaceOn && indoorTemp < thermoTarget + 1.5) {
            indoorTemp += 0.5;
            // Furnace dries air slightly
            indoorDp -= 0.05;
        }

        // A/C
        if (acOn && indoorTemp > thermoTarget - 1.5) {
            indoorTemp -= 0.5;
            // A/C removes moisture
            indoorDp -= 0.15;
        }

        // Activities
        const actData = activities[act];
        if (act === 'humidifier') {
            // Target 35% RH by raising dew point
            const currentRH = calcRH(indoorTemp, indoorDp);
            if (currentRH < 35) {
                indoorDp += 0.5;
            }
        } else if (act !== 'none') {
            if (activityTimer < actData[2]) {
                indoorTemp += actData[0];
                indoorDp += actData[1];
                activityTimer++;
            }
        }

        // Clamp dew point to not exceed indoor temp
        if (indoorDp > indoorTemp) indoorDp = indoorTemp;
        if (indoorDp < -40) indoorDp = -40;

        updateDisplay();
    }

    // Reset activity timer when activity changes
    document.getElementById('activity').addEventListener('change', () => {
        activityTimer = 0;
    });

    updateDisplay();
    setInterval(simTick, 1000);
    </script>
</body>
</html>
